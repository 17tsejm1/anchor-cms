(function() {
	var title = $('input[name=title]'), slug = $('input[name=slug]');
	var changedSlug = false;

	var string_to_slug = function(str) {
		str = str.replace(/^\s+|\s+$/g, ''); // trim
		str = str.toLowerCase();

		// remove accents, swap ñ for n, etc
		var from = "àáäâèéëêìíïîòóöôùúüûñç·/_,:;";
		var to   = "aaaaeeeeiiiioooouuuunc------";

		for(var i = 0, l = from.length; i < l; i++) {
			str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));
		}

		return str.replace(/[^a-z0-9 -]/g, '') // remove invalid chars
			.replace(/\s+/g, '-') // collapse whitespace and replace by -
			.replace(/-+/g, '-'); // collapse dashes
	}

	slug.bind('keyup', function() {
		changedSlug = true;
	});

	title.bind('keyup', function() {
		if( ! changedSlug) {
			slug.val(string_to_slug(title.val()));
		}
	});
}());